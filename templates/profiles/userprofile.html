{% extends '../app/profile_base.html' %}
{% block content %}

{% load static %}
<div class="col">
  <div class="container">
  <div class="home-top row mt-5">


<div class="go_back mr-auto mt-1 ml-3">
  <a href="{% url 'home' %}" >
<i class="fa fa-arrow-left  " style="font-size: 30px;"></i>
</a>
</div>
<div class="ml-auto mt-2 mr-3">
    <h6> {{ posts_count }} Posts</h6>
</div>
  
</div>
  
	
	

    <div class="profile-cover">
      {% if profile_detail.cover_image %}
      <img src="{{ profile_detail.cover_image.url }}" alt="User Avatar" id="user-main-cover">
  {% else %}
      <img src="{% static 'img/4.png' %}" alt="Default Avatar" id="user-main-cover">
  {% endif %}
  
    </div>


    


		<div class="profile-image mb-1">
      {% if profile_detail.avatar %}
            <img src="{{ profile_detail.avatar.url }}" alt="User Avatar" id="user-main-avatar">
        {% else %}
            <img src="{% static 'img/default_avatar.jpg' %}" alt="Default Avatar" id="user-main-avatar">
        {% endif %}
		</div>

   
  <div class="profile-info">

    <div class="row">
      <div class="mr-auto mt-5  ml-4">
      <p class="user-name-tag "><b>{{profile_detail.name}}</b> <br> <span class="blue  " >@{{profile_detail.user.username}} </span></p>
    </div>

    <div class="edit-btn ml-auto mt-3 mr-4">
      {% if profile_detail.user == user %}
      <button class="btn btn-outline-dark px-3"  data-toggle="modal" data-target="#ProfileEditModal"><i class="fa-solid fa-user-pen"></i> Edit </button>
      {% endif %}

      {% if follows and followed_by %}
      <a href="{% url 'private_chat' other_user_id=user.id %}" class="btn btn-outline-dark" id="chat-button"><i class="fa-regular fa-comment"></i></a>

      {% endif %}
       
      {% if request.user != profile_user %}
  <button id="follow-button" data-username="{{ profile_user.username }}" class="btn btn-primary">
    {% if follows %}
      Unfollow
    {% else %}
      Follow
    {% endif %}
  </button>
{% endif %}

    </div>
    </div>
  <div class="social-stats row social-bio mt-2 ml-2 ">
                
    <p> {{profile_detail.bio}} </p><br>

</div>

<div class="icon-info row mt-2 ml-3">
  <div><p><i class="fa-solid fa-location-dot"></i> {{profile_detail.location}}<b></b></p></div>
  <div> Joined {{profile_detail.user.date_joined|date:"M, Y" }}</div>

  </p>
</div> 
  <div><p class="mt-2 text-center"><i class="fa-solid fa-link"></i>  <a href="{{ profile_detail.website }}" target="_blank">{{ profile_detail.website }}</a>
<br>

</div>
        
           

			<div class="social-stats mt-3 row ml-2">
				<div class="col-4"><h3>
                    <b>{{ posts_count }}</b>
                </h3>
            <p>Posts</p></div>
           
              <div class="col-4">
                <a href="{% url 'follow_list' profile_detail.user.username %}">

                <h3>
            <b> {{ profile_detail.following.count }}</b>
                 </h3>
                <p>Following<osts/p>
                </a>
            </div>
          

        <div class="col-4">
          <a href="{% url 'follow_list' profile_detail.user.username %}">

            <h3>
            <b> {{ profile_detail.followers.count }}</b>
            </h3>
            <p>Followers</p>
          </a>  

        </div>
            
			</div>
      

	</div>

    



    <div class=" profile-feed ">

        
        <ul class="tabs-bar text-center">
          <li id="tab1" class="tab tab-active">My Posts</li>
          <li id="tab2" class="tab">Replies</li>
          <li id="tab3" class="tab">Likes</li>


          
        </ul>
        </br>
        <div class="content-container">
          <div class="content content-tab1 content-active">
      
            <div class="app--feed">
              {% if posts %}
              {% for post in profile_posts %}
              <div class="row mt-2">

     
      
                <div class="post_card  mb-2 col-12 "> 
                  <div class="row">
                
                 <div class="ml-auto  mr-3 mt-5">
                    <div class="card-action">
                <div class="dropdown">
                <a href="javascript:void();" class="dropdown-toggle-nocaret" data-toggle="dropdown">
                 <i class="fa-solid fa-ellipsis"></i>
           
                </a>
                 <div class="dropdown-menu dropdown-menu-right">
                 <a class="dropdown-item" href="{% url 'delete_post' post.id %}"><i class="fa-solid fa-trash-can  mr-2"></i> Delete </a>
                 <a class="dropdown-item" href="javascript:void();"><i class="fa-regular fa-flag  mr-2"></i> Report post</a>
                 <button class="dropdown-item btn btn-light copy-url-button" data-url="{{ post.get_absolute_url }}" ><i class="fa-solid fa-link mr-1"></i> Copy link</button>
                
           
           
                  </div>
                 </div>
               
                </div>
               </div>
             </div>
              
           
                 <div class="post_card--brand ">
                   <div class="brand__info">
                     <!-- Post Company Name (Cumulus by default) and Sponsored or Organic post (remove Sponsored if Organic Post) -->
           
                     <div class="name-tag ">
           
                       <div class=" account-details-hover">
                        
                         <div class="account-hover-content p-3">
                           <div class="account-avatar ml-2 row">
                            <div class="">
                             <img src="{% static 'img/avatar.jpg'%}" alt="">
                           </div>
                          
                           <div class="ml-auto">
                             {% if request.user != post.posted_by %}
                             <button class="follow-button px-3 mr-2 btn btn-rounded" data-profile-username="{{ post.posted_by }}"
                                     data-initial-state="{% if request.user.username in post.posted_by.following.all %}unfollow{% else %}follow{% endif %}">
                                 {% if request.user.username in post.posted_by.following.all %}
                                     Following
                                 {% else %}
                                     Follow
                                 {% endif %}
                             </button>
           
                             {% endif %}
                         </div>
           
                         </div>
                         
                         <a href="{% url 'view_profile' post.posted_by%}">
                         <div class="  ml-2">
                           
                           <p><span><b>{{post.poster_full}} </b></span> 
                             <span><i class="fa-solid fa-circle-check blue "></i></span> <br> @{{post.posted_by}} </p>
                         </div>
           
                           <div class="ml-2"><p>{{post.poster_bio |truncatechars:50 }}</p></div>
           
                         </a>               
                           
                         </div>
                       
                       </div>
                       
                       <div class="follow-account ">
                         <div class="account-avatar">
                           <img src="{% static 'img/avatar.jpg'%}" c alt="">
                         </div>
                         <div class="user-details ">
                           <p><b>{{post.poster_full}} </b> <i class="fa-solid fa-circle-check blue"></i>  . {{post.whenpublished}} </p>
                           <p class="blue">@{{post.posted_by}}</p>
                         </div>
                       
                     </div>
           
                     
                     </div>
                   </div>
                 </div>
                 
                 <div class=" ml-auto topic_badge">
                   <a href="{% url 'topic_'|add:post.topic %}" class="badge badge-pill badge-primary topic_badge mr-2">{{post.topic|title}}</a> 
           
                 </div>
                <div class="container mt-2">
             
           
                 <div class="post-body">
                   <p class="short-body">
                     <a href="{% url 'post_detail' post.id %}" id="post-body" >
                     {{ post.body|slice:":144" }}{% if post.body|length > 50 %}...{% endif %}
                   </a>
                   </p>
                     
                   <p class="full-body">
                     <a href="{% url 'post_detail' post.id %}" id="post-body" >
           
                     {{ post.body }}</a> </p>
                   {% if post.body|length > 50 %}
                       <a class="show-more-link">Show more</a>
                   {% endif %}
                   <a class="show-less-link blue" style="display: none; ">Show less</a>
           
               </div>
                   
                       {% if post.post_image %}
                       <a href="{% url 'post_detail' post.id %}">
                 <div class="post_card--creative mt-2">
           
                   <img src="{{ post.post_image.url }}">
                  
                   
               </div> </a>
             
               {% endif %}
                 
                
               <div class="post_card--summary">
                 <!-- <a href="#">
                   <div class="post_card--cta">
                     <div class="price mr-2">
                     <span>
                       <b>Tip Creator</b>
                     </span>
                   </div>
                     <span><button class="btn btn-outline-danger btn-rounded px-"> TIP </button></span>
                   </div>
                 </a> -->
                   <!-- DO NOT CHANGE THIS IMAGE -->
                   <div class="post_card--input--left mt-2 ">
           
                     <div class="post-icons">
                       <button class="comment-button btn btn-light" data-post-id="{{ post.id }}">
                         <i class="fa-regular fa-comment"></i>
                         <span class="post-engagement ml-2" id="comment-count-{{ post.id }}">{{ post.comment_count }}</span>
           
                       </button>
                     </div>
           
                       <div class=" like row ">
                         {% if user.is_authenticated %}
                         
                         <form action="{% url 'upvote_post' post.id %}" method="post">
                           {% csrf_token %}
                         <span class=" ml-2"> 
                             <button  class="btn btn-light upvote-button {% if user in post.likes.all or post.id in clicked_buttons %} clicked-button{% endif %}" data-post-id="{{ post.id }}"> <i class="fa-regular fa-thumbs-up"></i> </button>         
                         </span>
                         </form>
                       
                       <span class="ml-2 mt-2" id="vote-count-{{ post.id }}" > {{ post.vote_count }} </span>
               
                       <form action="{% url 'downvote_post' post.id %}" method="post">
                         {% csrf_token %}
                       <span class=" ml-2">
                         <button  class="btn btn-light downvote-button {% if user in post.dislikes.all %} clicked-button{% endif %}" data-post-id="{{ post.id }}"> <i class="fa-regular fa-thumbs-up fa-rotate-180"></i> </button>
                       </span>
                       </form>
                       {% endif %}
                       </div>
           
           
                      <div class="post-icons  mr-3">
                       <button class="repost-button btn btn-light" data-post-id="{{ post.id }}" >
                         <i class="fa-solid fa-retweet"></i> 
                         <span class="post-engagement">13</span>
                         </button>
                     </div>
           
                 
           
                   
                   
                 
           
             
           
                   <!-- DO NOT CHANGE THIS IMAGE -->
                 </div>
                
                 
                
               
                 </div>
                 <form class="comment-form mt-3" data-post-id="{{ post.id }}">
                   {% csrf_token %}
           
                   <div class="row " id="comment_form">
                     <div class="col-11">
                   <textarea name="comment" placeholder="Add a comment"></textarea>
                 </div>
                 <div class="col-1 actions">
                   <button type="submit" class="btn btn-primary "><i class="fa-solid fa-share"></i></button>
                   <!-- <button type="button" class="cancel-comment btn btn-light"><i class="fa-solid fa-xmark red"></i></button> -->
                   </div>
                   </div>
                 </form>
                 </div>
           
                 
           
                 </div>
                 </div>
     {% endfor %}

                 {% else %}
                 <p class="mt-3 text-center"> You haven't made any posts yet </p>

                 <p class="mt-3 mb-3 text-center"><a  href="#" class="new-post"> <i class="fa-solid fa-circle-plus"></i> </a></p>
                  {% endif %}
                  <div class="spacer"></div>
        <!-- END FEED-->
      </div>
      
          </div>
          <div class="content content-tab2">
      
            <div class="app--feed">
      
           
      
           
          <!-- 2nd post -->
          <div class="post_card">
            <div class="post_card--brand">
              <div class="brand__logo"><img src="https://image.s4.sfmc-content.com/lib/fe32117276640474721671/m/1/4a2f6bdb-b381-4982-ad59-4e7f26ee2028.jpg"/></div>
              <div class="brand__info">
                <!-- Post Company Name (Cumulus by default) and Sponsored or Organic post (remove Sponsored if Organic Post) -->
                <span class="bold"><b>Mercedes Benz</b> @mercedesbenz<span><img src="https://image.s4.sfmc-content.com/lib/fe32117276640474721671/m/1/b1eeb5f0-24d4-4393-8620-5af0b174fa38.png" class="badge" /></span></span>
              </div>
            </div>
                <div><p>we’ve got it all. Cumulus offers the products, services, knowledge, and resources necessary for your financial success.<span class="blue">See more...</span> </p></div>
      
            <div class="post_card--creative">
              <img src="https://image.s4.sfmc-content.com/lib/fe32117276640474721671/m/1/db182ecd-6028-4104-ad8d-245b2b42d3ce.jpg">
              </img>
          </div>
          <div class="post_card--summary">
            <a href="https://cumulusfinserv.com/">
              <div class="post_card--cta">
                <span><b>KES 13,100,000</b></span>
                <span><button class="btn btn-light">Make Offer</button></span>
              </div>
            </a>
            <div class="post_card--input">
              <!-- DO NOT CHANGE THIS IMAGE -->
              <div class="post_card--input--left">
              <span class="post-icons"><i class="fa-solid fa-heart"></i></span><span class="post-engagement">300</span>
              <span class="post-icons ml-3"><i class="fa-regular fa-comment"></i></span><span class="post-engagement">40</span>
              <span class="post-icons ml-3"><i class="fa-solid fa-chart-simple"></i></span><span class="post-engagement">3.7k</span>
            </div>
            <div class="post_card--input--right mt-3">
              <span class="post-icons"><i class="fa-solid fa-square-plus"></i></span>
            </div>
              <!-- DO NOT CHANGE THIS IMAGE -->
            </div>
           
          </div>
        </div>
        <!-- END FEED-->
      </div>
      
          </div>
          
          <div class="content content-tab3">
      
            <div class="app--feed">
      
           
      
           
          <!-- 2nd post -->
          <div class="post_card">
            <div class="post_card--brand">
              <div class="brand__logo"><img src="https://image.s4.sfmc-content.com/lib/fe32117276640474721671/m/1/4a2f6bdb-b381-4982-ad59-4e7f26ee2028.jpg"/></div>
              <div class="brand__info">
                <!-- Post Company Name (Cumulus by default) and Sponsored or Organic post (remove Sponsored if Organic Post) -->
                <span class="bold"><b>Mercedes Benz</b> @mercedesbenz<span><img src="https://image.s4.sfmc-content.com/lib/fe32117276640474721671/m/1/b1eeb5f0-24d4-4393-8620-5af0b174fa38.png" class="badge" /></span></span>
              </div>
            </div>
                <div><p>we’ve got it all. Cumulus offers the products, services, knowledge, and resources necessary for your financial success.<span class="blue">See more...</span> </p></div>
      
            <div class="post_card--creative">
              <img src="https://image.s4.sfmc-content.com/lib/fe32117276640474721671/m/1/db182ecd-6028-4104-ad8d-245b2b42d3ce.jpg">
              </img>
          </div>
          <div class="post_card--summary">
            <a href="https://cumulusfinserv.com/">
              <div class="post_card--cta">
                <span><b>KES 13,100,000</b></span>
                <span><button class="btn btn-light">Make Offer</button></span>
              </div>
            </a>
            <div class="post_card--input">
              <!-- DO NOT CHANGE THIS IMAGE -->
              <div class="post_card--input--left">
              <span class="post-icons"><i class="fa-solid fa-heart"></i></span><span class="post-engagement">300</span>
              <span class="post-icons ml-3"><i class="fa-regular fa-comment"></i></span><span class="post-engagement">40</span>
              <span class="post-icons ml-3"><i class="fa-solid fa-chart-simple"></i></span><span class="post-engagement">3.7k</span>
            </div>
            <div class="post_card--input--right mt-3">
              <span class="post-icons"><i class="fa-solid fa-square-plus"></i></span>
            </div>
              <!-- DO NOT CHANGE THIS IMAGE -->
            </div>
           
          </div>
        </div>
        <!-- END FEED-->
      </div>
      
          </div>
        </div>
   
          
          
      
      </div>
</div>
</div>

<div class="modal fade" id="ProfileEditModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body mx-auto">
        <form method="POST" class="text-center ">
            {% csrf_token %}
    
            <div class="mx-auto profile-bg">
              <div class="profile-cover">
                  <label for="cover-image-input">
                      {% if profile_detail.cover_image %}
                          <img src="{{ profile_detail.cover_image.url }}" alt="User Avatar" id="user-cover">
                      {% else %}
                          <img src="{% static 'img/4.png' %}" alt="Default Avatar" id="user-cover">
                      {% endif %}
                  </label>
                  <!-- Hidden input for cover image upload -->
                  <input type="file" id="cover-image-input" accept="image/*" style="display: none;">
              </div>
      
              <div class="profile-image mb-1">
                  <label for="avatar-modal-input">
                      {% if profile_detail.avatar %}
                          <img src="{{ profile_detail.avatar.url }}" alt="User Avatar" id="user-avatar">
                      {% else %}
                          <img src="{% static 'img/default_avatar.jpg' %}" alt="Default Avatar" id="user-avatar">
                      {% endif %}
                  </label>
                  <!-- Hidden input for avatar upload -->
                  <input type="file" id="avatar-modal-input" accept="image/*" style="display: none;">
              </div>
          </div>
            <div class="col-lg-12 text-center mt-2">
                {{ edit_profile_form.name }}
            </div>
            <div class="col-lg-12 text-center mt-2">
                {{ edit_profile_form.location }}
            </div>
            <div class="col-lg-12 text-center mt-2">
                {{ edit_profile_form.website }}
            </div>
            <div class="col-lg-12 text-center mt-2">
                {{ edit_profile_form.bio }}
            </div>
            <div class="more-edit mt-2">
                <a class="btn btn-light " href="{% url 'edit_profile' %}"> More Settings </a>
                <button type="submit" class="btn btn-rounded ml-2 px-3 " id="save-changes-button">Save Changes</button>
            </div>
        </form>
    </div>
    
      <div class="modal-footer">
      
      </div>
    </div>
  </div>
</div>



{%endblock%}